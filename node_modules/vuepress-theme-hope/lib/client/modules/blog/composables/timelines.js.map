{"version":3,"file":"timelines.js","sourceRoot":"","sources":["../../../../../src/client/modules/blog/composables/timelines.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,OAAO,EAAE,MAAM,yBAAyB,CAAC;AAElD,OAAO,EAAE,WAAW,EAAE,MAAM,8BAA8B,CAAC;AAE3D,OAAO,EAAE,QAAQ,EAAE,MAAM,EAAE,OAAO,EAAE,MAAM,KAAK,CAAC;AAGhD,OAAO,EAAE,eAAe,EAAE,MAAM,6BAA6B,CAAC;AAe9D,MAAM,CAAC,MAAM,eAAe,GAA+B,MAAM,CAC/D,gBAAgB,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC,EAAE,CACpC,CAAC;AAEF;;GAEG;AACH,MAAM,CAAC,MAAM,YAAY,GAAG,GAAiB,EAAE;IAC7C,MAAM,SAAS,GAAG,MAAM,CAAC,eAAe,CAAC,CAAC;IAE1C,IAAI,CAAC,SAAS;QAAE,MAAM,IAAI,KAAK,CAAC,4CAA4C,CAAC,CAAC;IAE9E,OAAO,SAAS,CAAC;AACnB,CAAC,CAAC;AAEF;;GAEG;AACH,MAAM,CAAC,MAAM,cAAc,GAAG,GAAS,EAAE;IACvC,MAAM,SAAS,GAAG,WAAW,CAAc,UAAU,CAAC,CAAC;IAEvD,MAAM,aAAa,GAAG,QAAQ,CAAC,GAAG,EAAE;QAClC,MAAM,aAAa,GAAmB,EAAE,CAAC;QAEzC,qBAAqB;QACrB,SAAS,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,EAAE,EAAE;YAC/C,MAAM,MAAM,GAAG,OAAO,CAAC,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC,CAAC;YAEnD,IAAI,MAAM,EAAE,CAAC;gBACX,MAAM,IAAI,GAAG,MAAM,CAAC,WAAW,EAAE,CAAC;gBAClC,MAAM,KAAK,GAAG,MAAM,CAAC,QAAQ,EAAE,GAAG,CAAC,CAAC;gBACpC,MAAM,GAAG,GAAG,MAAM,CAAC,OAAO,EAAE,CAAC;gBAE7B,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,aAAa,CAAC,CAAC,CAAC,CAAC,IAAI,KAAK,IAAI;oBACrD,aAAa,CAAC,OAAO,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC,CAAC;gBAE7C,aAAa,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC;oBAC1B,IAAI,EAAE,GAAG,KAAK,IAAI,GAAG,EAAE;oBACvB,IAAI;oBACJ,IAAI;iBACL,CAAC,CAAC;YACL,CAAC;QACH,CAAC,CAAC,CAAC;QAEH,OAAO;YACL,GAAG,SAAS,CAAC,KAAK;YAClB,MAAM,EAAE,aAAa,CAAC,OAAO,EAAE;SAChC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,OAAO,CAAC,eAAe,EAAE,aAAa,CAAC,CAAC;AAC1C,CAAC,CAAC","sourcesContent":["import { getDate } from \"@vuepress/helper/client\";\nimport type { Article } from \"@vuepress/plugin-blog/client\";\nimport { useBlogType } from \"@vuepress/plugin-blog/client\";\nimport type { ComputedRef, InjectionKey } from \"vue\";\nimport { computed, inject, provide } from \"vue\";\n\nimport type { ArticleInfo } from \"../../../../shared/index.js\";\nimport { ArticleInfoType } from \"../../../../shared/index.js\";\n\ndeclare const __VUEPRESS_DEV__: boolean;\n\nexport interface TimelineItem {\n  year: number;\n  items: { date: string; path: string; info: ArticleInfo }[];\n}\n\nexport type TimelinesRef = ComputedRef<{\n  path: string;\n  config: TimelineItem[];\n  items: Article<ArticleInfo>[];\n}>;\n\nexport const timelinesSymbol: InjectionKey<TimelinesRef> = Symbol(\n  __VUEPRESS_DEV__ ? \"timelines\" : \"\",\n);\n\n/**\n * Inject timelines\n */\nexport const useTimelines = (): TimelinesRef => {\n  const timelines = inject(timelinesSymbol);\n\n  if (!timelines) throw new Error(\"useTimelines() is called without provider.\");\n\n  return timelines;\n};\n\n/**\n * Provide timelines\n */\nexport const setupTimelines = (): void => {\n  const timelines = useBlogType<ArticleInfo>(\"timeline\");\n\n  const timelineItems = computed(() => {\n    const timelineItems: TimelineItem[] = [];\n\n    // Filter before sort\n    timelines.value.items.forEach(({ info, path }) => {\n      const result = getDate(info[ArticleInfoType.date]);\n\n      if (result) {\n        const year = result.getFullYear();\n        const month = result.getMonth() + 1;\n        const day = result.getDate();\n\n        if (!timelineItems[0] || timelineItems[0].year !== year)\n          timelineItems.unshift({ year, items: [] });\n\n        timelineItems[0].items.push({\n          date: `${month}/${day}`,\n          info,\n          path,\n        });\n      }\n    });\n\n    return {\n      ...timelines.value,\n      config: timelineItems.reverse(),\n    };\n  });\n\n  provide(timelinesSymbol, timelineItems);\n};\n"]}