import{isLinkHttp as A,isLinkAbsolute as E,startsWith as C,endsWith as F,isArray as L,isString as v,isPlainObject as H,isFunction as P}from"@vuepress/helper/client";import{defineComponent as h,ref as R,onMounted as T,h as i,computed as S}from"vue";import{usePageData as b,usePageFrontmatter as _}from"vuepress/client";import{Popup as M,openPopupWindow as O}from"vuepress-shared/client";import"balloon-css/balloon.css";import"vuepress-shared/client/styles/popup.scss";import"../styles/share-service.scss";const g=t=>document.querySelector(`meta[name="${t}"]`)?.getAttribute("content")??null,w=(t,l="")=>{const o=["vp-share-icon",l];return A(t)||E(t)?i("img",{class:o,src:t,loading:"lazy","no-view":""}):C(t,"<")&&F(t,">")?i("div",{class:o,innerHTML:t}):i("div",{class:[...o,t]})};var $=h({name:"ShareService",props:{config:{type:Object,default:()=>({})},plain:Boolean,title:{type:String,required:!1},description:{type:String,required:!1},url:{type:String,required:!1},summary:{type:String,required:!1},cover:{type:String,required:!1},tag:{type:[Array,String],required:!1}},setup(t){let l;const o=b(),c=_(),e=R(!1),a=()=>{const r=t.title??o.value.title,n=t.description??c.value.description??g("description")??g("og:description")??g("twitter:description"),u=t.url??typeof window>"u"?null:window.location.href,m=t.cover??g("og:image"),p=document.querySelector(`${SHARE_CONTENT_SELECTOR} :not(a) > img`)?.getAttribute("src"),f=t.tag??c.value.tag??c.value.tags,y=L(f)?f.filter(v).join(","):v(f)?f:null;return t.config.link.replace(/\[([^\]]+)\]/g,(B,q)=>{const G=q.split("|");for(const s of G){if(s==="url"&&u)return u;if(s==="title"&&r)return r;if(s==="description"&&n)return n;if(s==="summary"&&t.summary)return t.summary;if(s==="cover"&&m)return m;if(s==="image"&&p)return p;if(s==="tags"&&y)return y}return""})},d=()=>{const r=a();switch(t.config.action){case"navigate":window.open(r);break;case"open":window.open(r,"_blank");break;case"qrcode":import("qrcode").then(({toDataURL:n})=>n(r,{errorCorrectionLevel:"H",width:250,scale:1,margin:1.5})).then(n=>{l.emit(`<img src="${n}" alt="qrcode" class="share-qrcode" />`)});break;default:O(r,"share")}};return T(()=>{l=new M}),()=>{const{config:{name:r,icon:n,shape:u,color:m},plain:p}=t;return[i("button",{type:"button",class:["vp-share-button",{plain:p}],"aria-label":r,"data-balloon-pos":"up",onClick:()=>d()},p?w(u,"plain"):n?w(n):i("div",{class:"vp-share-icon colorful",style:{background:m},innerHTML:u})),e.value?i("div",{class:"share-popup"}):null]}}});const k=SHARE_SERVICES;var j=h({name:"Share",props:{services:{type:[String,Array],default:()=>k.map(({name:t})=>t)},titleGetter:{type:Function,default:t=>t.title},descriptionGetter:{type:Function,default:t=>t.frontmatter.description},summaryGetter:{type:Function,default:t=>t.summary},coverGetter:{type:Function,default:t=>t.cover},tagGetter:{type:Function,default:({frontmatter:t})=>t.tag||t.tags},inline:Boolean,colorful:Boolean},setup(t){const l=b(),o=S(()=>(v(t.services)?t.services.split(","):t.services).map(e=>H(e)?e.name&&e.link?e:null:k.find(({name:a})=>a===e)).filter(e=>!!e)),c=S(()=>{const e={};return["titleGetter","descriptionGetter","summaryGetter","coverGetter","tagGetter"].forEach(a=>{if(P(t[a])){const d=t[a](l.value);d&&(e[a.replace("Getter","")]=d)}}),e});return()=>i("div",{class:"vp-share-buttons",style:t.inline?{display:"inline-block"}:{}},o.value.map(e=>i($,{config:e,...c.value,plain:!t.colorful})))}});export{j as default};
//# sourceMappingURL=Share.js.map
