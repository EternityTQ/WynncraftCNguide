{"version":3,"file":"config.js","sources":["../../src/client/composables/setup.ts","../../src/client/config.ts"],"sourcesContent":["import { usePageData, usePageFrontmatter } from \"@vuepress/client\";\nimport { isLinkHttp, isPlainObject, removeEndingSlash } from \"@vuepress/shared\";\nimport { useEventListener } from \"@vueuse/core\";\nimport { computed, onMounted, watchEffect } from \"vue\";\nimport type { RequiredLocaleConfig } from \"vuepress-shared/client\";\nimport { useLocaleConfig } from \"vuepress-shared/client\";\n\nimport type {\n  CopyrightLocaleData,\n  CopyrightPluginFrontmatter,\n  CopyrightPluginPageData,\n} from \"../../shared/index.js\";\n\ndeclare const COPYRIGHT_CANONICAL: string;\ndeclare const COPYRIGHT_DISABLE_COPY: boolean;\ndeclare const COPYRIGHT_DISABLE_SELECTION: boolean;\ndeclare const COPYRIGHT_GLOBAL: boolean;\ndeclare const COPYRIGHT_LOCALES: RequiredLocaleConfig<CopyrightLocaleData>;\ndeclare const COPYRIGHT_MAX_LENGTH: number;\ndeclare const COPYRIGHT_TRIGGER_LENGTH: number;\n\nconst canonical = COPYRIGHT_CANONICAL;\n\nexport const setupCopyright = (): void => {\n  const frontmatter = usePageFrontmatter<CopyrightPluginFrontmatter>();\n  const locale = useLocaleConfig(COPYRIGHT_LOCALES);\n  const page = usePageData<CopyrightPluginPageData>();\n\n  const enabled = computed(\n    () =>\n      Boolean(frontmatter.value.copy) ||\n      (frontmatter.value.copy !== false && COPYRIGHT_GLOBAL),\n  );\n\n  const copyOptions = computed(() =>\n    isPlainObject(frontmatter.value.copy) ? frontmatter.value.copy : null,\n  );\n\n  const disableCopy = computed(\n    () => copyOptions.value?.disableCopy ?? COPYRIGHT_DISABLE_COPY,\n  );\n\n  const disableSelection = computed(() =>\n    enabled.value\n      ? copyOptions.value?.disableSelection ?? COPYRIGHT_DISABLE_SELECTION\n      : false,\n  );\n\n  const maxLength = computed(() =>\n    enabled.value ? copyOptions.value?.maxLength ?? COPYRIGHT_MAX_LENGTH : 0,\n  );\n\n  const triggerLength = computed(\n    () => copyOptions.value?.triggerLength ?? COPYRIGHT_TRIGGER_LENGTH,\n  );\n\n  const getCopyright = (): string => {\n    const { author: authorInfo = \"\", license: licenseInfo = \"\" } =\n      page.value.copyright;\n    const { author, license, link } = locale.value;\n\n    return [\n      authorInfo ? author.replace(\":author\", authorInfo) : \"\",\n      licenseInfo ? license.replace(\":license\", licenseInfo) : \"\",\n      link.replace(\n        \":link\",\n        canonical\n          ? `${removeEndingSlash(\n              isLinkHttp(canonical) ? canonical : `https://${canonical}`,\n            )}${page.value.path}`\n          : window.location.href,\n      ),\n    ]\n      .filter((item) => item)\n      .join(\"\\n\");\n  };\n\n  const onCopy = (event: ClipboardEvent): void => {\n    const selection = getSelection();\n\n    if (selection) {\n      const textRange = selection.getRangeAt(0);\n\n      if (enabled.value) {\n        const textLength = textRange.toString().length;\n\n        if (\n          disableCopy.value ||\n          (maxLength.value && textLength > maxLength.value)\n        )\n          return event.preventDefault();\n\n        if (textLength >= triggerLength.value) {\n          event.preventDefault();\n\n          const copyright = getCopyright();\n          const node = document.createElement(\"div\");\n\n          node.appendChild(selection.getRangeAt(0).cloneContents());\n\n          if (event.clipboardData) {\n            event.clipboardData.setData(\n              \"text/html\",\n              `${node.innerHTML}<hr><div class=\"copyright\">${copyright.replace(\n                /\\\\n/g,\n                \"<br>\",\n              )}</div>`,\n            );\n            event.clipboardData.setData(\n              \"text/plain\",\n              `${\n                selection.getRangeAt(0).cloneContents().textContent || \"\"\n              }\\n------\\n${copyright}`,\n            );\n          }\n        }\n      }\n    }\n  };\n\n  onMounted(() => {\n    const appElement = document.querySelector<HTMLDivElement>(\"#app\")!;\n\n    useEventListener(appElement, \"copy\", onCopy);\n\n    watchEffect(() => {\n      appElement.style.userSelect = disableSelection.value ? \"none\" : \"auto\";\n    });\n  });\n};\n","import { defineClientConfig } from \"@vuepress/client\";\n\nimport { setupCopyright } from \"./composables/index.js\";\n\nexport default defineClientConfig({\n  setup: () => {\n    setupCopyright();\n  },\n});\n"],"names":["canonical","setupCopyright","frontmatter","usePageFrontmatter","locale","useLocaleConfig","page","usePageData","enabled","computed","copyOptions","isPlainObject","disableCopy","_a","disableSelection","maxLength","triggerLength","getCopyright","authorInfo","licenseInfo","author","license","link","removeEndingSlash","isLinkHttp","item","onCopy","event","selection","textRange","textLength","copyright","node","onMounted","appElement","useEventListener","watchEffect","defineClientConfig"],"mappings":"+VAqBA,MAAMA,EAAY,oBAELC,EAAiB,IAAY,CACxC,MAAMC,EAAcC,IACdC,EAASC,EAAgB,iBAAiB,EAC1CC,EAAOC,EAAqC,EAE5CC,EAAUC,EACd,IACE,CAAA,CAAQP,EAAY,MAAM,MACzBA,EAAY,MAAM,OAAS,IAAS,gBACzC,EAEMQ,EAAcD,EAAS,IAC3BE,EAAcT,EAAY,MAAM,IAAI,EAAIA,EAAY,MAAM,KAAO,IACnE,EAEMU,EAAcH,EAClB,IAAG,CAvCP,IAAAI,EAuCU,QAAAA,EAAAH,EAAY,QAAZ,YAAAG,EAAmB,cAAe,sBAC1C,CAAA,EAEMC,EAAmBL,EAAS,IAAG,CA1CvC,IAAAI,EA2CI,OAAAL,EAAQ,QACJK,EAAAH,EAAY,QAAZ,KAAAG,OAAAA,EAAmB,mBAAoB,4BACvC,GACN,EAEME,EAAYN,EAAS,IAAG,CAhDhC,IAAAI,EAiDI,OAAAL,EAAQ,QAAQK,EAAAH,EAAY,QAAZ,KAAAG,OAAAA,EAAmB,YAAa,qBAAuB,CAAA,CACzE,EAEMG,EAAgBP,EACpB,IAAG,CArDP,IAAAI,EAqDU,QAAAA,EAAAH,EAAY,QAAZ,KAAAG,OAAAA,EAAmB,gBAAiB,wBAC5C,CAAA,EAEMI,EAAe,IAAc,CACjC,KAAM,CAAE,OAAQC,EAAa,GAAI,QAASC,EAAc,EAAG,EACzDb,EAAK,MAAM,UACP,CAAE,OAAAc,EAAQ,QAAAC,EAAS,KAAAC,CAAK,EAAIlB,EAAO,MAEzC,MAAO,CACLc,EAAaE,EAAO,QAAQ,UAAWF,CAAU,EAAI,GACrDC,EAAcE,EAAQ,QAAQ,WAAYF,CAAW,EAAI,GACzDG,EAAK,QACH,QACAtB,EACI,GAAGuB,EACDC,EAAWxB,CAAS,EAAIA,EAAY,WAAWA,CAAS,EAC1D,CAAC,GAAGM,EAAK,MAAM,IAAI,GACnB,OAAO,SAAS,IACtB,CACF,EACG,OAAQmB,GAASA,CAAI,EACrB,KAAK;AAAA,CAAI,CACd,EAEMC,EAAUC,GAAgC,CAC9C,MAAMC,EAAY,eAElB,GAAIA,EAAW,CACb,MAAMC,EAAYD,EAAU,WAAW,CAAC,EAExC,GAAIpB,EAAQ,MAAO,CACjB,MAAMsB,EAAaD,EAAU,SAAW,EAAA,OAExC,GACEjB,EAAY,OACXG,EAAU,OAASe,EAAaf,EAAU,MAE3C,OAAOY,EAAM,iBAEf,GAAIG,GAAcd,EAAc,MAAO,CACrCW,EAAM,iBAEN,MAAMI,EAAYd,EACZe,EAAAA,EAAO,SAAS,cAAc,KAAK,EAEzCA,EAAK,YAAYJ,EAAU,WAAW,CAAC,EAAE,eAAe,EAEpDD,EAAM,gBACRA,EAAM,cAAc,QAClB,YACA,GAAGK,EAAK,SAAS,8BAA8BD,EAAU,QACvD,OACA,MACF,CAAC,QACH,EACAJ,EAAM,cAAc,QAClB,aACA,GACEC,EAAU,WAAW,CAAC,EAAE,cAAA,EAAgB,aAAe,EACzD;AAAA;AAAA,EAAaG,CAAS,EACxB,EAEJ,CACF,CACF,CACF,EAEAE,EAAU,IAAM,CACd,MAAMC,EAAa,SAAS,cAA8B,MAAM,EAEhEC,EAAiBD,EAAY,OAAQR,CAAM,EAE3CU,EAAY,IAAM,CAChBF,EAAW,MAAM,WAAapB,EAAiB,MAAQ,OAAS,MAClE,CAAC,CACH,CAAC,CACH,EC7HA,IAAeuB,EAAAA,EAAmB,CAChC,MAAO,IAAM,CACXpC,EAAe,CACjB,CACF,CAAC"}